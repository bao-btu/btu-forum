window.vBulletin=window.vBulletin||{};window.vBulletin.phrase=window.vBulletin.phrase||{};window.vBulletin.phrase.precache=window.vBulletin.phrase.precache||[];window.vBulletin.phrase.precache=$.merge(window.vBulletin.phrase.precache,[]);(function(A){var B=[".forum-channel-content-widget",".blog-channel-content-widget",".sg-channel-content-widget"];if(!vBulletin.pageHasSelectors(B)){return false}A(document).ready(function(){vBulletin.conversation=vBulletin.conversation||{};var F=A(".channel-content-widget .channel-conversation-list-wrapper");var H=A("#activity-stream-tab",F);var M=A("#recommended-tab",F);var N=A("#subscribed-tab",F);var c=A("#topic-tab",F);var I=A("#media-tab",F);var O=A(".conversation-list",H);var f=A(".conversation-list",M);var Y=A(".conversation-list",N);var d=A(".conversation-list",c);var V=A(".conversation-list",F);var K,e,S,Z,C;var b,a,T,E;var L,X,U,W;var J=F.find(".widget-tabs-nav .ui-tabs-nav > li"),R=J.filter(".ui-tabs-selected"),Q=R.index(),h,D=J.parent().data("allow-history")=="1",G=new vBulletin.history.instance(D);if(Q==-1){Q=0;R=J.first()}h=R.find("> a").attr("href");var P=function(i){var j=(F.offset().top+(F.outerHeight()-parseFloat(F.css("border-bottom-width")))-i.height());console.log(j);return j};var g=function(i){i=i||h;return J.filter('li:has(a[href*="'+i+'"])').first().index()};J.removeClass("ui-state-disabled");vBulletin.tabify.call(F,{tabHistory:G,getTabIndexByHash:g,allowHistory:D,tabParamAsQueryString:true,hash:F.find(".js-module-top-anchor").attr("id"),tabOptions:{selected:Q,select:function(k,l){if(U){U.hideFilterOverlay()}if(S){S.hideFilterOverlay()}if(T){T.hideFilterOverlay()}var j=F.find(".widget-tabs-panel .ui-tabs-panel:visible");var i=j.find(".list-item-body-wrapper.edit-post .edit-conversation-container");if(i.length>0){openAlertDialog({title:vBulletin.phrase.get("edit_conversation"),message:vBulletin.phrase.get("you_have_a_pending_edit_unsaved"),iconType:"warning",onAfterClose:function(){vBulletin.animateScrollTop(i.closest(".list-item").offset().top,{duration:"slow"})}});return false}},show:function(l,n){if(n.tab.hash=="#activity-stream-tab"){if(S){S.toggleNewConversations(false)}if(!U){L=A(".conversation-toolbar-wrapper.scrolltofixed-floating",H);X=new vBulletin.scrollToFixed({element:L,limit:P(L)});var k=new vBulletin.pagination({context:H,allowHistory:D,onPageChanged:function(p,q){U.updatePageNumber(p);if(!q){U.applyFilters(false,true,false,true)}}});U=new vBulletin.conversation.filter({context:H,autoCheck:A(".toolbar-filter-overlay input[type=radio][value=conversations_on]",H).is(":checked"),scrollToTop:F,pagination:k,allowHistory:D,onContentLoad:function(){X.updateLimit(P(L));vBulletin.truncatePostContent(O);vBulletin.conversation.processPostContent(O)}});if(h==n.tab.hash){vBulletin.truncatePostContent(O);vBulletin.conversation.processPostContent(O);U.lastFilters={filters:U.getSelectedFilters(A(".toolbar-filter-overlay",H))}}}else{U.setOption("context",H);if(typeof U.lastFilters!="undefined"&&A(".conversation-empty:not(.h-hide)",n.panel).length>0){delete U.lastFilters}}U.applyFilters(false,true)}else{if(n.tab.hash=="#subscribed-tab"){if(U){U.toggleNewConversations(false)}if(S){S.toggleNewConversations(false)}if(!T){b=A(".conversation-toolbar-wrapper.scrolltofixed-floating",N);a=new vBulletin.scrollToFixed({element:b,limit:P(b)});T=new vBulletin.conversation.filter({context:N,scrollToTop:F,allowHistory:D,onContentLoad:function(){a.updateLimit(P(b));vBulletin.truncatePostContent(Y);vBulletin.conversation.processPostContent(Y)}});if(h==n.tab.hash){vBulletin.truncatePostContent(Y);vBulletin.conversation.processPostContent(Y);T.lastFilters={filters:T.getSelectedFilters(A(".toolbar-filter-overlay",N))}}}else{T.setOption("context",N);if(typeof T.lastFilters!="undefined"&&A(".conversation-empty:not(.h-hide)",n.panel).length>0){delete T.lastFilters}}T.applyFilters(false)}else{if(n.tab.hash=="#topic-tab"){if(U){U.toggleNewConversations(false)}if(!S){K=A(".conversation-toolbar-wrapper.scrolltofixed-floating",c);e=new vBulletin.scrollToFixed({element:K,limit:P(K)});var o=new vBulletin.pagination({context:c,allowHistory:D,onPageChanged:function(p,q){S.updatePageNumber(p);if(!q){S.applyFilters(false,true,false,true)}}});S=new vBulletin.conversation.filter({context:c,autoCheck:A(".toolbar-filter-overlay input[type=radio][value=conversations_on]",c).is(":checked"),scrollToTop:F,pagination:o,allowHistory:D,onContentLoad:function(){e.updateLimit(P(K));vBulletin.markreadcheck()}});if(h==n.tab.hash){S.lastFilters={filters:S.getSelectedFilters(A(".toolbar-filter-overlay",c))}}}else{S.setOption("context",c);if(typeof S.lastFilters!="undefined"&&A(".conversation-empty:not(.h-hide)",n.panel).length>0){delete S.lastFilters}}S.applyFilters(false,true)}else{if(n.tab.hash=="#media-tab"){if(U){U.toggleNewConversations(false)}if(S){S.toggleNewConversations(false)}if(!Z){Z=A(".conversation-toolbar-wrapper.scrolltofixed-floating",I);C=new vBulletin.scrollToFixed({element:Z,limit:P(Z)});var j=I.data("filterHistory-instance")||new vBulletin.history.instance(D);I.data("media-filterHistory-instance",j);if(j.isEnabled()){var m=j.getState();if(!m||A.isEmptyObject(m.data)){var i={from:"filter",page:1,tab:n.tab.hash,filters:vBulletin.getSelectedFilters(A("form.toolbar-filter-overlay",n.panel))};j.setDefaultState(i,document.title,location.href)}j.setStateChange(function(s,t,q){var r=j.getState();if(r.data.from=="filter"){j.log(r.data,r.title,r.url);if(n.tab.hash!=r.data.tab){vBulletin.selectTabByIndex.call(A(n.tab).closest(".ui-tabs-nav"),n.index)}else{var p=A('.media-filter-overlay input[name="filter_time"][value="{0}"]'.format(r.data.filters.filter_time),n.panel).prop("checked",true);if(p.hasClass("js-default-checked")&&p.prop("defaultChecked")){A(".filtered-by .x",n.panel).trigger("click")}else{p.trigger("change",[true])}}}},"filter")}}if(A("#profileMediaDetailContainer .album-detail",n.panel).length==0){if(!E){E=vBulletin.media.calculatePhotosPerPage(vBulletin.media.TARGET_PHOTOS_PERPAGE)}loadGalleryById({nodeid:-2,channelid:pageData.channelid,pageno:1,dateFilter:"time_lastweek",perpage:E},false,0,{complete:function(){A(".profile-toolbar .media-toolbar-filter",I).removeClass("h-hide");C.updateLimit(P(Z))}})}}}}}}}});V.off("click",".list-item-poll .view-more-ctrl").on("click",".view-more-ctrl",function(j){var i=A(this).closest("form.poll");var k=i.find("ul.poll");A(this).addClass("h-hide");k.css("max-height","none").find("li.h-hide").slideDown(100,function(){i.find(".action-buttons").removeClass("h-hide").next(".view-less-ctrl").removeClass("h-hide");vBulletin.animateScrollTop(i.offset().top,{duration:"fast"})});return false});V.off("click",".list-item-poll .view-less-ctrl").on("click",".view-less-ctrl",function(j){var i=A(this).closest("form.poll");vBulletin.conversation.limitVisiblePollOptionsInAPost(i,3);i.find("ul.poll").css("max-height","").find("li.h-hide").slideUp(100);return false});V.off("click",".post-history").on("click",".post-history",vBulletin.conversation.showPostHistory);V.off("click",".ipAddress").on("click",".ipAddress",vBulletin.conversation.showIp);V.off("click",".editCtrl").on("click",".editCtrl",function(i){vBulletin.conversation.editPost.apply(this,[i,U])});V.off("click",".voteCtrl").on("click",".voteCtrl",function(i){if(A(i.target).closest(".bubble-flyout").length==1){vBulletin.conversation.showWhoVoted.apply(i.target,[i])}else{vBulletin.conversation.votePost.apply(this,[i])}return false});V.off("click",".flagCtrl").on("click",".flagCtrl",vBulletin.conversation.flagPost);V.off("click",".commentCtrl").on("click",".commentCtrl",vBulletin.conversation.toggleCommentBox);V.off("click",".post-comment-btn").on("click",".post-comment-btn",function(i){vBulletin.conversation.postComment.apply(this,[i,function(){U.updatePageNumber(1).applyFilters(false,true)}])});vBulletin.conversation.bindEditFormEventHandlers("all")})})(jQuery);